\documentclass[12pt]{article}

% input
\bibliographystyle{ieeetr}
\usepackage[utf8]{inputenc}
%\usepackage{times} % font
\usepackage{lmodern} % scalable font
\usepackage[pdftex]{graphicx} % include graphics
\usepackage{amsmath} % align, nobreakdash
\usepackage[pdf,tmpdir]{graphviz} % digraph
\usepackage{fullpage} % book margins -> std margins
\usepackage{wrapfig} % wrapfigure
%\usepackage{moreverb} % verbatimtabinput
\usepackage{subcaption} % subcaptionbox
\usepackage[colorlinks]{hyperref} % pdf links
\usepackage{url} % url support
%\usepackage{comment} % comment
\usepackage{xfrac}
\usepackage[table]{xcolor}

\usepackage{siunitx}
%\usepackage{graphicx} already
\usepackage{latexsym}
\usepackage{keyval}
\usepackage{ifthen}
\usepackage{moreverb}
\usepackage[siunitx, subfolder]{gnuplottex}

% https://tex.stackexchange.com/questions/259247/rescaling-gnuplottex-to-fit-in-subfigure
%\usepackage{epstopdf}
%\usepackage{printlen}
%\usepackage[utf8]{inputenx}
%\usepackage{xparse}
%\ExplSyntaxOn
%\DeclareExpandableDocumentCommand{\convertlen}{ O{cm} m }
% {
%  \dim_to_unit:nn { #2 } { 1 #1 } cm
% }
%\ExplSyntaxOff
% fuck it, just guess

\newcommand{\code}[1]{\colorbox{light-gray}{\texttt{#1}}}
\def\Scale{0.5}

% colourize titles
\definecolor{light-gray}{gray}{0.95}
\definecolor{ilrblue}{RGB}{79,166,220}
\usepackage{titling}
\pretitle{\vspace{-3em}\fontfamily{\sfdefault}\fontsize{18bp}{18bp}\color{ilrblue}\selectfont}
\posttitle{\par\vspace{18bp}}
\preauthor{\normalfont\bfseries\selectfont\MakeUppercase}
\postauthor{\par\vspace{4bp}}
\predate{\normalfont\selectfont}
\postdate{\par\vspace{-8bp}}
\usepackage{titlesec}
\titleformat{\section}{\fontfamily{\sfdefault}\selectfont\normalsize\bfseries\color{ilrblue}\MakeUppercase}{\thesection}{1em}{}
\titleformat{\subsection}{\fontfamily{\sfdefault}\normalsize\bfseries\color{ilrblue}}{\thesubsection}{1em}{}
\titleformat{\subsubsection}{\fontfamily{\sfdefault}\normalsize\bfseries\color{ilrblue}\it}{\thesubsubsection}{1em}{}
\makeatletter
\renewenvironment{abstract}{%
    \if@twocolumn
      \section*{\abstractname}%
    \else \small %
      \begin{center}%
        {\bfseries\color{ilrblue} \abstractname\vspace{\z@}\vspace{-6bp}}%
      \end{center}%
      \quotation
    \fi}
    {\if@twocolumn\else\endquotation\fi}
\makeatother

% for hyperref
\hypersetup{
  linkcolor=ilrblue, % internal (figure) links
  urlcolor=ilrblue,
  filecolor=ilrblue,
  citecolor=ilrblue, % bibliography links
  pdfauthor={Neil},
  pdftitle={Tree},
  pdfsubject={Tree},
  pdfpagemode=UseNone
}

\author{Neil A. Edelman}
\title{Practical B-tree design}
\date{2022-08-05}

\begin{document}

\maketitle

\abstract{Several design decisions for a minimal in-memory B-tree are discussed, covering bulk-loading, insertion, and deletion. Any allocations are fail-fast before modifying the tree so that it remains in a valid state. Concurrency not considered.}





\section{Design}

A tree is used as an ordered set or map. For memory locality, this is implemented B-tree\cite{bayer1972organization}. In an implementation for C, we would expect memory usage to be low, performance to be high, and simplicity over complexity. Practically, this means that B$^+$-trees and B$^*$-trees are less attractive, along with an added layer of order statistic tree. The nodes are linked one-way and iteration is very simple. This precludes multi-maps. The use-case has no concurrency and places importance on modification with operations being as lazy as is reasonably possible.

\subsection{Branching factor}

The branching factor, or order as \cite{knuth1998sorting}, is a fixed value between $[3,\text{UINT\_MAX}+1]$. The implementation has no buffering or middle-memory management. Thus, a high-order means greater memory allocation granularity, leading to asymptotically desirable trees. Small values produce much more compact trees. In general, it is left-leaning where convenient because keys on the right side are faster to move because of the array configuration of the nodes.

\subsection{Minimum and maximum keys}

We use fixed-length nodes. In \cite{goodrich2011data}, these are $(a,b)$-trees as $(\text{minimum}+1, \text{maxumum}+1)$\nobreakdash-trees. That is, the maximum is the node's key capacity. Since the keys can be thought of as an implicit complete binary tree, necessarily maximum+1 is the order. Unlike \cite{knuth1998sorting}, we differentiate by branch and leaf; a leaf node has no need for null-children, so we don't include them.

Performance will be
$\mathcal{O}(\log \text{size})$. Equation~\ref{usual-min} gives the standard B-tree key minimum in terms of the key maximum. (Equivalent to the specifying the minimum children as a function of the order.)

% \lceil order / 2 \rceil children
% \lceil order / 2 \rceil - 1 keys
% \lceil (max+1) / 2 \rceil - 1 keys
% This can be simplified!
%\text{child}_\text{minimum} &= \left\lceil \frac{\text{order}}{2}\right\rceil \nonumber \\
%\text{minimum} &= \left\lceil \frac{\text{maximum}+1}{2} \right\rceil - 1 \label{usual-min}

\begin{align}
\text{minimum} &= \left\lfloor \frac{\text{maximum}}{2} \right\rfloor \label{usual-min}
\end{align}

Equation~\ref{usual-min} represents the maximum minimum without borrowing from the siblings. However, freeing at empty gives good results in \cite{johnson1993b}. We compromise with Equation~\ref{min}. Designed to be less-eager and provides some hysteresis while balancing asymptotic performance.

\begin{align}
\text{minimum} = \max\left(1, \left\lfloor \frac{\text{maximum}}{3} \right\rfloor \right) \label{min}
\end{align}

In a sense, it is the opposite of a B$^*$-tree\cite{knuth1998sorting, comer1979ubiquitous}, where $\frac{1}{3}$ instead of $\frac{2}{3}$ of the capacity is full. It doesn't affect the shape of the tree unless deletions are performed, where instead of being stricter, it is lazier.





\section{Operations}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Bulk loading}

\begin{figure}%
	\centering%
	\subcaptionbox{Bulk add 1, 2.\label{bulk:2}}{%
		\digraph[scale=\Scale]{bulk2}{
	graph [truecolor=true, bgcolor=transparent, fontname="Bitstream Vera Sans", splines=false];
	node [shape=none, fontname="Bitstream Vera Sans"];
	trunk0x1005326f0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Argda</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">1</td>
	<td border="0" align="center" port="1">2</td>
	</tr>
</table>>];
		}
	}
	\subcaptionbox{Bulk add 3.\label{bulk:3}}{%
		\digraph[scale=\Scale]{bulk3}{
	graph [truecolor=true, bgcolor=transparent, fontname="Bitstream Vera Sans", splines=false];
	node [shape=none, fontname="Bitstream Vera Sans"];
	trunk0x10200c010 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Snamog</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">3</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x10200c010:0:sw -> trunk0x1005326f0;
	trunk0x10200c010:0:se -> trunk0x10200b1e0;
	trunk0x1005326f0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Argda</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">1</td>
	<td border="0" align="center" port="1">2</td>
	</tr>
</table>>];
	trunk0x10200b1e0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Mausnar</font></td></tr>
	<hr/>
	<tr>
	<td border="0" port="0">&nbsp;</td>
	</tr>
</table>>];
		}
	}\\
	\subcaptionbox{Finalize after 3.\label{bulk:3finish}}{%
		\digraph[scale=\Scale]{bulk3finish}{
	graph [truecolor=true, bgcolor=transparent, fontname="Bitstream Vera Sans", splines=false];
	node [shape=none, fontname="Bitstream Vera Sans"];
	trunk0x10200c010 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Snamog</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">2</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x10200c010:0:sw -> trunk0x1005326f0;
	trunk0x10200c010:0:se -> trunk0x10200b1e0;
	trunk0x1005326f0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Argda</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">1</td>
	</tr>
</table>>];
	trunk0x10200b1e0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Mausnar</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">3</td>
	</tr>
</table>>];
		}
	}
	\subcaptionbox{Or bulk add 4.\label{bulk:4}}{%
		\digraph[scale=\Scale]{bulk4}{
	graph [truecolor=true, bgcolor=transparent, fontname="Bitstream Vera Sans", splines=false];
	node [shape=none, fontname="Bitstream Vera Sans"];
	trunk0x10200c010 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Snamog</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">3</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x10200c010:0:sw -> trunk0x1005326f0;
	trunk0x10200c010:0:se -> trunk0x10200b1e0;
	trunk0x1005326f0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Argda</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">1</td>
	<td border="0" align="center" port="1">2</td>
	</tr>
</table>>];
	trunk0x10200b1e0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Mausnar</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">4</td>
	</tr>
</table>>];
		}
	}
    \caption{Order-3, maximum keys 2, bulk-addition, with labels for nodes.
\ref{bulk:2}. Keys 1, 2: full tree.
\ref{bulk:3}. Adding 3 increases the height, with new nodes (branch) \code{Snamog} and (leaf) \code{Mausnar}. Minimum invariant is violated for \code{Mausnar}.
\ref{bulk:3finish}. Finalize would balance all the right nodes below the root.
\ref{bulk:4}. Or continue adding 4 to \ref{bulk:3}.}%
	\label{bulk}%
\end{figure}%

Bulk loading buffers, as described in \cite{graefe2011modern}, is too complex for our purposes. Here, the user must supply the keys in order. Such that, a key undergoing bulk-add is packed to the lowest height on the right side, ignoring the rules for splitting. A key recruits zero-key nodes below as needed. When the tree is full, the height increases.

Because the B-tree rule for the minimum number of keys may be violated on bulk-add, it's important to finalize the tree. This balances and restores the B-tree invariants on the right side of the tree, under the root.

Initially, this will efficiently produce a more compact tree. For example, Figure~\ref{bulk} shows bulk addition of natural numbers in order. Compare adding them normally: after a split, there's not any more keys to be added on the low side; this asymptotically results in one-half occupancy.





%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Adding a key}

\begin{figure}
	\centering%
	\digraph[scale=\Scale]{add}{
	graph [truecolor=true, bgcolor=transparent, fontname="Bitstream Vera Sans"];
	node [shape=record, style=filled, fontname="Bitstream Vera Sans", fillcolor="Grey90"];
	edge [fontname="Bitstream Vera Sans"];
	add [shape=circle, style=none];
	error [label="ERROR", shape=none, style=none];
	error2 [label="ERROR", shape=none, style=none];
	unique [label="UNIQUE", shape=none, style=none];
	present [label="PRESENT", shape=none, style=none];
	idle -> error;
	add -> idle [label="root dne"];
	add -> empty [label="root empty"];
	add -> descend;
	idle -> empty;
	empty -> insert;
	descend -> present [label="equal"];
	descend -> insert [label="hole=add"];
	descend -> grow;
	grow -> split;
	grow -> error2;
	split -> split;
	split -> fill -> unique;
	insert -> unique;
	}
    \caption{The requirements for \code{add} are $\mathcal{O}(1)$ space and $\mathcal{O}(\log \text{size})$ time, with no parent pointers. State diagram of adding a key, traversing a maximum twice.}%
	\label{add}%
\end{figure}%

In \cite{bayer1972organization, knuth1998sorting, comer1979ubiquitous}, insertion is a $\mathcal{O}(\log_{\text{minimum}+1} \text{size})$ operation. In theory, the key is inserted in a leaf node. If this operation causes the leaf to be overfull, the leaf is split into two, with the median element promoted. This repeats until all the nodes are within the specified key maximum. If implemented directly, this requires an extra temporary element to be added to each node and double-linking to access the parent node.

It is advantageous, then, to flip the insertion and keep track of the hole, getting rid of the temporary size overload and moving the intermediate keys only once. A potential state machine is shown schematically in Figure~\ref{add}. \code{idle} is no dynamic memory; \code{empty} contains an unused node. \code{ERROR} from \code{idle} and \code{grow} is a memory error; the state of the tree remains unchanged.

The \code{descend} path is taken by any non-empty tree, and descends to find the space in the leaf that it will go. It stops with \code{PRESENT} if it finds an already present match. When it completes finding a new key in a leaf node, the \code{hole} will be the lowest-height node that has free space in the path from the root to that leaf.

A non-empty leaf node results in the \code{insert} path, and a single time down the tree. Specifying a high-order makes taking this path more likely than having to repeat the \code{grow} path.

\begin{figure}
	\centering%
%	\subcaptionbox{Full tree of even numbers.\label{even:full}}{%
%		\digraph[scale=0.45]{add0}{
%	graph [truecolor=true, bgcolor=transparent, fontname="Bitstream Vera Sans", splines=false];
%	node [shape=none, fontname="Bitstream Vera Sans"];
%	trunk0x100604080 [label = <
%<table border="0" cellspacing="0">
%	<tr><td border="0" colspan="2"><font color="Gray75">Iabug</font></td></tr>
%	<hr/>
%	<tr>
%	<td border="0" align="center" port="0">18</td>
%	<td border="0" align="center" port="1">36</td>
%	</tr>
%	<hr/>
%	<tr><td></td></tr>
%</table>>];
%	trunk0x100604080:0:sw -> trunk0x100604480;
%	trunk0x100604080:0:se -> trunk0x10281b590;
%	trunk0x100604080:1:se -> trunk0x1006040f0;
%	trunk0x100604480 [label = <
%<table border="0" cellspacing="0">
%	<tr><td border="0" colspan="2"><font color="Gray75">Dabshar</font></td></tr>
%	<hr/>
%	<tr>
%	<td border="0" align="center" port="0">6</td>
%	<td border="0" align="center" port="1">12</td>
%	</tr>
%	<hr/>
%	<tr><td></td></tr>
%</table>>];
%	trunk0x100604480:0:sw -> trunk0x100537ef0;
%	trunk0x100604480:0:se -> trunk0x1006040e0;
%	trunk0x100604480:1:se -> trunk0x100604520;
%	trunk0x100537ef0 [label = <
%<table border="0" cellspacing="0">
%	<tr><td border="0" colspan="2"><font color="Gray75">Fidan</font></td></tr>
%	<hr/>
%	<tr>
%	<td border="0" align="center" port="0">2</td>
%	<td border="0" align="center" port="1">4</td>
%	</tr>
%</table>>];
%	trunk0x1006040e0 [label = <
%<table border="0" cellspacing="0">
%	<tr><td border="0" colspan="2"><font color="Gray75">Rutdan</font></td></tr>
%	<hr/>
%	<tr>
%	<td border="0" align="center" port="0">8</td>
%	<td border="0" align="center" port="1">10</td>
%	</tr>
%</table>>];
%	trunk0x100604520 [label = <
%<table border="0" cellspacing="0">
%	<tr><td border="0" colspan="2"><font color="Gray75">Umologath</font></td></tr>
%	<hr/>
%	<tr>
%	<td border="0" align="center" port="0">14</td>
%	<td border="0" align="center" port="1">16</td>
%	</tr>
%</table>>];
%	trunk0x10281b590 [label = <
%<table border="0" cellspacing="0">
%	<tr><td border="0" colspan="2"><font color="Gray75">Radien</font></td></tr>
%	<hr/>
%	<tr>
%	<td border="0" align="center" port="0">24</td>
%	<td border="0" align="center" port="1">30</td>
%	</tr>
%	<hr/>
%	<tr><td></td></tr>
%</table>>];
%	trunk0x10281b590:0:sw -> trunk0x10281b5c0;
%	trunk0x10281b590:0:se -> trunk0x100531520;
%	trunk0x10281b590:1:se -> trunk0x100537dd0;
%	trunk0x10281b5c0 [label = <
%<table border="0" cellspacing="0">
%	<tr><td border="0" colspan="2"><font color="Gray75">Ickpuga</font></td></tr>
%	<hr/>
%	<tr>
%	<td border="0" align="center" port="0">20</td>
%	<td border="0" align="center" port="1">22</td>
%	</tr>
%</table>>];
%	trunk0x100531520 [label = <
%<table border="0" cellspacing="0">
%	<tr><td border="0" colspan="2"><font color="Gray75">Nashsinat</font></td></tr>
%	<hr/>
%	<tr>
%	<td border="0" align="center" port="0">26</td>
%	<td border="0" align="center" port="1">28</td>
%	</tr>
%</table>>];
%	trunk0x100537dd0 [label = <
%<table border="0" cellspacing="0">
%	<tr><td border="0" colspan="2"><font color="Gray75">Etholog</font></td></tr>
%	<hr/>
%	<tr>
%	<td border="0" align="center" port="0">32</td>
%	<td border="0" align="center" port="1">34</td>
%	</tr>
%</table>>];
%	trunk0x1006040f0 [label = <
%<table border="0" cellspacing="0">
%	<tr><td border="0" colspan="2"><font color="Gray75">Ufthluk</font></td></tr>
%	<hr/>
%	<tr>
%	<td border="0" align="center" port="0">42</td>
%	<td border="0" align="center" port="1">48</td>
%	</tr>
%	<hr/>
%	<tr><td></td></tr>
%</table>>];
%	trunk0x1006040f0:0:sw -> trunk0x100537120;
%	trunk0x1006040f0:0:se -> trunk0x1005329b0;
%	trunk0x1006040f0:1:se -> trunk0x100535b20;
%	trunk0x100537120 [label = <
%<table border="0" cellspacing="0">
%	<tr><td border="0" colspan="2"><font color="Gray75">Azansha</font></td></tr>
%	<hr/>
%	<tr>
%	<td border="0" align="center" port="0">38</td>
%	<td border="0" align="center" port="1">40</td>
%	</tr>
%</table>>];
%	trunk0x1005329b0 [label = <
%<table border="0" cellspacing="0">
%	<tr><td border="0" colspan="2"><font color="Gray75">Fimak</font></td></tr>
%	<hr/>
%	<tr>
%	<td border="0" align="center" port="0">44</td>
%	<td border="0" align="center" port="1">46</td>
%	</tr>
%</table>>];
%	trunk0x100535b20 [label = <
%<table border="0" cellspacing="0">
%	<tr><td border="0" colspan="2"><font color="Gray75">Shaak</font></td></tr>
%	<hr/>
%	<tr>
%	<td border="0" align="center" port="0">50</td>
%	<td border="0" align="center" port="1">52</td>
%	</tr>
%</table>>];
%		}
%	}\\
	\subcaptionbox{Add 9; four new nodes, the first split.\label{even:work1}}{%
		\digraph[width=0.4\textwidth]{evenwork1}{
	graph [truecolor=true, bgcolor=transparent, fontname="Bitstream Vera Sans", splines=false];
	node [shape=none, fontname="Bitstream Vera Sans"];
	trunk0x10075f990 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Urbolgun</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">hole</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x10075f990:0:sw -> trunk0x100604080;
	trunk0x10075f990:0:se -> trunk0x10075f9c0;
	trunk0x100604080 [label = <
<table border="0" cellspacing="0" bgcolor="Grey95">
	<tr><td border="0" colspan="2"><font color="Grey50">Iabug</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">18</td>
	<td border="0" align="center" port="1">36</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x100604080:0:sw -> trunk0x100604480;
	trunk0x100604080:0:se -> trunk0x10281b590;
	trunk0x100604080:1:se -> trunk0x1006040f0;
	trunk0x100604480 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Dabshar</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">6</td>
	<td border="0" align="center" port="1">12</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x100604480:0:sw -> trunk0x100537ef0;
	trunk0x100604480:0:se -> trunk0x1006040e0;
	trunk0x100604480:1:se -> trunk0x100604520;
	trunk0x100537ef0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Fidan</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">2</td>
	<td border="0" align="center" port="1">4</td>
	</tr>
</table>>];
	trunk0x1006040e0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Rutdan</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">8</td>
	<td border="0" align="center" port="1">10</td>
	</tr>
</table>>];
	trunk0x100604520 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Umologath</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">14</td>
	<td border="0" align="center" port="1">16</td>
	</tr>
</table>>];
	trunk0x10281b590 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Radien</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">24</td>
	<td border="0" align="center" port="1">30</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x10281b590:0:sw -> trunk0x10281b5c0;
	trunk0x10281b590:0:se -> trunk0x100531520;
	trunk0x10281b590:1:se -> trunk0x100537dd0;
	trunk0x10281b5c0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Ickpuga</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">20</td>
	<td border="0" align="center" port="1">22</td>
	</tr>
</table>>];
	trunk0x100531520 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Nashsinat</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">26</td>
	<td border="0" align="center" port="1">28</td>
	</tr>
</table>>];
	trunk0x100537dd0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Etholog</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">32</td>
	<td border="0" align="center" port="1">34</td>
	</tr>
</table>>];
	trunk0x1006040f0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Ufthluk</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">42</td>
	<td border="0" align="center" port="1">48</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x1006040f0:0:sw -> trunk0x100537120;
	trunk0x1006040f0:0:se -> trunk0x1005329b0;
	trunk0x1006040f0:1:se -> trunk0x100535b20;
	trunk0x100537120 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Azansha</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">38</td>
	<td border="0" align="center" port="1">40</td>
	</tr>
</table>>];
	trunk0x1005329b0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Fimak</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">44</td>
	<td border="0" align="center" port="1">46</td>
	</tr>
</table>>];
	trunk0x100535b20 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Shaak</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">50</td>
	<td border="0" align="center" port="1">52</td>
	</tr>
</table>>];
	trunk0x10075f9c0 [label = <
<table border="0" cellspacing="0" bgcolor="Grey95">
	<tr><td border="0" colspan="1"><font color="Gray50">Beoub</font></td></tr>
	<hr/>
	<tr>
	<td border="0" port="0">&nbsp;</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x10075f9c0:0:sw -> trunk0x10075f9f0;
	trunk0x10075f9f0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Naagh</font></td></tr>
	<hr/>
	<tr>
	<td border="0" port="0">&nbsp;</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x10075f9f0:0:sw -> trunk0x100735af0;
	trunk0x100735af0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Olog</font></td></tr>
	<hr/>
	<tr>
	<td border="0" port="0">&nbsp;</td>
	</tr>
</table>>];
	node [color="Red"];
		}
	}
	\subcaptionbox{After one split.\label{even:work2}}{%
		\digraph[width=0.4\textwidth]{evenwork2}{
	graph [truecolor=true, bgcolor=transparent, fontname="Bitstream Vera Sans", splines=false];
	node [shape=none, fontname="Bitstream Vera Sans"];
	trunk0x10075f990 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Urbolgun</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">18</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x10075f990:0:sw -> trunk0x100604080;
	trunk0x10075f990:0:se -> trunk0x10075f9c0;
	trunk0x100604080 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Iabug</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">hole</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x100604080:0:sw -> trunk0x100604480;
	trunk0x100604080:0:se -> trunk0x10075f9f0;
	trunk0x100604480 [label = <
<table border="0" cellspacing="0" bgcolor="Grey95">
	<tr><td border="0" colspan="2"><font color="Gray50">Dabshar</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">6</td>
	<td border="0" align="center" port="1">12</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x100604480:0:sw -> trunk0x100537ef0;
	trunk0x100604480:0:se -> trunk0x1006040e0;
	trunk0x100604480:1:se -> trunk0x100604520;
	trunk0x100537ef0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Fidan</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">2</td>
	<td border="0" align="center" port="1">4</td>
	</tr>
</table>>];
	trunk0x1006040e0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Rutdan</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">8</td>
	<td border="0" align="center" port="1">10</td>
	</tr>
</table>>];
	trunk0x100604520 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Umologath</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">14</td>
	<td border="0" align="center" port="1">16</td>
	</tr>
</table>>];
	trunk0x10075f9f0 [label = <
<table border="0" cellspacing="0" bgcolor="Grey95">
	<tr><td border="0" colspan="1"><font color="Gray50">Naagh</font></td></tr>
	<hr/>
	<tr>
	<td border="0" port="0">&nbsp;</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x10075f9f0:0:sw -> trunk0x100735af0;
	trunk0x100735af0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Olog</font></td></tr>
	<hr/>
	<tr>
	<td border="0" port="0">&nbsp;</td>
	</tr>
</table>>];
	trunk0x10075f9c0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Beoub</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">36</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x10075f9c0:0:sw -> trunk0x10281b590;
	trunk0x10075f9c0:0:se -> trunk0x1006040f0;
	trunk0x10281b590 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Radien</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">24</td>
	<td border="0" align="center" port="1">30</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x10281b590:0:sw -> trunk0x10281b5c0;
	trunk0x10281b590:0:se -> trunk0x100531520;
	trunk0x10281b590:1:se -> trunk0x100537dd0;
	trunk0x10281b5c0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Ickpuga</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">20</td>
	<td border="0" align="center" port="1">22</td>
	</tr>
</table>>];
	trunk0x100531520 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Nashsinat</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">26</td>
	<td border="0" align="center" port="1">28</td>
	</tr>
</table>>];
	trunk0x100537dd0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Etholog</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">32</td>
	<td border="0" align="center" port="1">34</td>
	</tr>
</table>>];
	trunk0x1006040f0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Ufthluk</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">42</td>
	<td border="0" align="center" port="1">48</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x1006040f0:0:sw -> trunk0x100537120;
	trunk0x1006040f0:0:se -> trunk0x1005329b0;
	trunk0x1006040f0:1:se -> trunk0x100535b20;
	trunk0x100537120 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Azansha</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">38</td>
	<td border="0" align="center" port="1">40</td>
	</tr>
</table>>];
	trunk0x1005329b0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Fimak</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">44</td>
	<td border="0" align="center" port="1">46</td>
	</tr>
</table>>];
	trunk0x100535b20 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Shaak</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">50</td>
	<td border="0" align="center" port="1">52</td>
	</tr>
</table>>];
		}
	}
	\subcaptionbox{Further split.\label{even:work3}}{%
		\digraph[width=0.4\textwidth]{evenwork3}{
	graph [truecolor=true, bgcolor=transparent, fontname="Bitstream Vera Sans", splines=false];
	node [shape=none, fontname="Bitstream Vera Sans"];
	trunk0x10075f990 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Urbolgun</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">18</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x10075f990:0:sw -> trunk0x100604080;
	trunk0x10075f990:0:se -> trunk0x10075f9c0;
	trunk0x100604080 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Iabug</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">hole</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x100604080:0:sw -> trunk0x100604480;
	trunk0x100604080:0:se -> trunk0x10075f9f0;
	trunk0x100604480 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Dabshar</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">6</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x100604480:0:sw -> trunk0x100537ef0;
	trunk0x100604480:0:se -> trunk0x1006040e0;
	trunk0x100537ef0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Fidan</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">2</td>
	<td border="0" align="center" port="1">4</td>
	</tr>
</table>>];
	trunk0x1006040e0 [label = <
<table border="0" cellspacing="0" bgcolor="Grey90">
	<tr><td border="0" colspan="2"><font color="Gray50">Rutdan</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">8</td>
	<td border="0" align="center" port="1">10</td>
	</tr>
</table>>];
	trunk0x10075f9f0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Naagh</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">12</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x10075f9f0:0:sw -> trunk0x100735af0;
	trunk0x10075f9f0:0:se -> trunk0x100604520;
	trunk0x100735af0 [label = <
<table border="0" cellspacing="0" bgcolor="Grey90">
	<tr><td border="0" colspan="1"><font color="Gray50">Olog</font></td></tr>
	<hr/>
	<tr>
	<td border="0" port="0">&nbsp;</td>
	</tr>
</table>>];
	trunk0x100604520 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Umologath</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">14</td>
	<td border="0" align="center" port="1">16</td>
	</tr>
</table>>];
	trunk0x10075f9c0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Beoub</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">36</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x10075f9c0:0:sw -> trunk0x10281b590;
	trunk0x10075f9c0:0:se -> trunk0x1006040f0;
	trunk0x10281b590 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Radien</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">24</td>
	<td border="0" align="center" port="1">30</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x10281b590:0:sw -> trunk0x10281b5c0;
	trunk0x10281b590:0:se -> trunk0x100531520;
	trunk0x10281b590:1:se -> trunk0x100537dd0;
	trunk0x10281b5c0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Ickpuga</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">20</td>
	<td border="0" align="center" port="1">22</td>
	</tr>
</table>>];
	trunk0x100531520 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Nashsinat</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">26</td>
	<td border="0" align="center" port="1">28</td>
	</tr>
</table>>];
	trunk0x100537dd0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Etholog</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">32</td>
	<td border="0" align="center" port="1">34</td>
	</tr>
</table>>];
	trunk0x1006040f0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Ufthluk</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">42</td>
	<td border="0" align="center" port="1">48</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x1006040f0:0:sw -> trunk0x100537120;
	trunk0x1006040f0:0:se -> trunk0x1005329b0;
	trunk0x1006040f0:1:se -> trunk0x100535b20;
	trunk0x100537120 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Azansha</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">38</td>
	<td border="0" align="center" port="1">40</td>
	</tr>
</table>>];
	trunk0x1005329b0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Fimak</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">44</td>
	<td border="0" align="center" port="1">46</td>
	</tr>
</table>>];
	trunk0x100535b20 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Shaak</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">50</td>
	<td border="0" align="center" port="1">52</td>
	</tr>
</table>>];
		}
	}
	\subcaptionbox{After fill.\label{even:insert}}{%
		\digraph[scale=0.45]{add1}{
	graph [truecolor=true, bgcolor=transparent, fontname="Bitstream Vera Sans", splines=false];
	node [shape=none, fontname="Bitstream Vera Sans"];
	trunk0x10075f990 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Urbolgun</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">18</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x10075f990:0:sw -> trunk0x100604080;
	trunk0x10075f990:0:se -> trunk0x10075f9c0;
	trunk0x100604080 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Iabug</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">9</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x100604080:0:sw -> trunk0x100604480;
	trunk0x100604080:0:se -> trunk0x10075f9f0;
	trunk0x100604480 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Dabshar</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">6</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x100604480:0:sw -> trunk0x100537ef0;
	trunk0x100604480:0:se -> trunk0x1006040e0;
	trunk0x100537ef0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Fidan</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">2</td>
	<td border="0" align="center" port="1">4</td>
	</tr>
</table>>];
	trunk0x1006040e0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Rutdan</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">8</td>
	</tr>
</table>>];
	trunk0x10075f9f0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Naagh</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">12</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x10075f9f0:0:sw -> trunk0x100735af0;
	trunk0x10075f9f0:0:se -> trunk0x100604520;
	trunk0x100735af0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Olog</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">10</td>
	</tr>
</table>>];
	trunk0x100604520 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Umologath</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">14</td>
	<td border="0" align="center" port="1">16</td>
	</tr>
</table>>];
	trunk0x10075f9c0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Beoub</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">36</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x10075f9c0:0:sw -> trunk0x10281b590;
	trunk0x10075f9c0:0:se -> trunk0x1006040f0;
	trunk0x10281b590 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Radien</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">24</td>
	<td border="0" align="center" port="1">30</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x10281b590:0:sw -> trunk0x10281b5c0;
	trunk0x10281b590:0:se -> trunk0x100531520;
	trunk0x10281b590:1:se -> trunk0x100537dd0;
	trunk0x10281b5c0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Ickpuga</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">20</td>
	<td border="0" align="center" port="1">22</td>
	</tr>
</table>>];
	trunk0x100531520 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Nashsinat</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">26</td>
	<td border="0" align="center" port="1">28</td>
	</tr>
</table>>];
	trunk0x100537dd0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Etholog</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">32</td>
	<td border="0" align="center" port="1">34</td>
	</tr>
</table>>];
	trunk0x1006040f0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Ufthluk</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">42</td>
	<td border="0" align="center" port="1">48</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x1006040f0:0:sw -> trunk0x100537120;
	trunk0x1006040f0:0:se -> trunk0x1005329b0;
	trunk0x1006040f0:1:se -> trunk0x100535b20;
	trunk0x100537120 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Azansha</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">38</td>
	<td border="0" align="center" port="1">40</td>
	</tr>
</table>>];
	trunk0x1005329b0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Fimak</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">44</td>
	<td border="0" align="center" port="1">46</td>
	</tr>
</table>>];
	trunk0x100535b20 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Shaak</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">50</td>
	<td border="0" align="center" port="1">52</td>
	</tr>
</table>>];
		}
	}
    \caption{Full order-3 tree: addition of any number will cause the tree height to increase.
    \ref{even:work1}~--~\ref{even:work3}: working down the tree in \code{split}. \ref{even:insert} after \code{fill}.}%
	\label{even}%
\end{figure}%

An add must \code{grow} if it has the maximum keys in the leaf node. The height of the \code{hole} (zero-based) is the number of nodes extra that need to be reserved. A null \code{hole} means all of the path is full of keys; this requires increased tree height: tree~height~+~2 new nodes. These new empty nodes are then strung together and added to the tree.

\code{split} introduces \code{cursor}, along the path to the leaf, and \code{sibling}, the new node ancestry. The \code{cursor} is initially the \code{hole}; it descends a second time, balancing with \code{sibling}, thus splits it with the new node. \code{hole} can either go to the left, right, or exactly in between. \code{cursor} descends on the path, and \code{sibling} descends on the new nodes. In \code{fill}, the added key then goes in \code{hole}.

In Figure~\ref{even}, the path from before \ref{even:work1} to \ref{even:insert} to insert 9 on Figure~\ref{add} is \code{descend}, \code{grow}, \code{split} four times (the maximum for this size), \code{fill}, and returns \code{UNIQUE}. The new nodes are (branches) \code{Urbolgun}, \code{Beoub}, \code{Naagh}, and (leaf) \code{Olog}. This is the most complicated path, when the height increases.




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Deleting a key}

\begin{figure}
	\centering%
	\digraph[scale=\Scale]{remove}{
	graph [truecolor=true, bgcolor=transparent, fontname="Bitstream Vera Sans"];
	node [shape=box, style=filled, fontname="Bitstream Vera Sans", fillcolor="Grey90"];
	edge [fontname="Bitstream Vera Sans"];
	remove [shape=circle, style=none];
	lookup [label="lookup rm"];
	remove -> lookup [label="when min, write parent"];
	lookup -> false;
	lookup -> branch;
	lookup -> upward;
	branch -> upward [label="transfer to leaf"];
	upward -> space [label="parent dne"];
	upward -> balance_less;
	upward -> balance_more;
	balance_less -> merge_less [label="min"];
	balance_more -> merge_more [label="min"];
	balance_less -> end;
	balance_more -> end;
	merge_less -> ascend;
	merge_more -> ascend;
	ascend -> upward;
	space -> end;
	end -> true;
	true [shape=none, style=none];
	false [shape=none, style=none];
	}
    \caption{\code{remove} is the opposite of \code{add} in Figure~\ref{add}. \code{rm} starts at the bottom; works up to find any node or siblings that have excess.}%
	\label{remove}%
\end{figure}%

Figure~\ref{remove} shows a schematic diagram of removal of one key . . .

intrim? provisional!

More work is needed to determine the optimal way of removing keys.


\section{Characteristics}

\subsection{Map}

When the tree set has an extra value {\it per} key that is not associated with the tree operations, it becomes a map. To facilitate cache performance, these values are not interspersed with the keys. On lookup, only the key's value is ever accessed or iterated over.

\subsection{Performance}

\begin{figure}%
\centering%
\begin{gnuplot}[terminal=cairolatex, terminaloptions={color dashed pdf size 6.2,3.4}]
set style line 1 lt 5 lw 2 lc rgb '#0072bd' pointtype 1 pointsize 0.5
set style line 2 lt 5 lw 2 lc rgb '#ff0000' pointtype 2 pointsize 0.5
set style line 3 lt 5 lw 2 lc rgb '#00ac33' pointtype 5 pointsize 0.5
set style line 4 lt 5 lw 2 lc rgb '#19d3f5' pointtype 5 pointsize 0.5
set grid
set xlabel "elements"
set ylabel "time per element, t (ns)"
set yrange [0:2000]
set log x
set format x '\tiny %g'
set format y '\tiny %g'
set for [i=1:8] linetype i dashtype i
plot \
"timing-std.tsv" using 1:($2/$1*1000):($3/$1*1000) with errorlines title "std$\:\:$map" ls 1, \
"timing-o3.tsv" using 1:($2/$1*1000):($3/$1*1000) with errorlines title "o3" ls 2, \
"timing-o4.tsv" using 1:($2/$1*1000):($3/$1*1000) with errorlines title "o4" ls 3, \
"timing-o128.tsv" using 1:($2/$1*1000):($3/$1*1000) with errorlines title "o128" ls 4, \
"timing-o257.tsv" using 1:($2/$1*1000):($3/$1*1000) with errorlines title "o257" ls 5, \
"timing-o2049.tsv" using 1:($2/$1*1000):($3/$1*1000) with errorlines title "o2049" ls 6
\end{gnuplot}
\caption{A comparison different orders and \code{std::map} in $C^{++}$ benchmark, with a log-$x$ scale.}%
\label{timing}%
\end{figure}%

Figure~\ref{timing} shows the common case where one has an ordered map of \code{int} to pointer. It is of straight insertion of random elements, (not in any order.) The keys are drawn from \code{rand} in $[0, 2\,147\,483\,647]$. This causes some probability of collision, which is much faster than insertion.

\code{std::map} is a red-black tree in \code{C++}. Though order~4 produces an isomorphism with left-leaning red-black trees\cite{sedgewick2008left}, it is very close in performance to an order-3 tree. This is probably because of the importance of caching: locality-of-reference in order-3 trees, which have up to 2 elements grouped together is very similar to having single elements.

Higher orders are generally more cache-friendly, but it gets to the point where all the data is in one node. This node is essentially an ordered array. Order~2049 is an example; with more data to be transferred every insertion, the performance goes down. The more the size in bytes of the individual keys (and values, if applicable,) the more large the nodes become, and this negative effect is exacerbated.

When choosing a default fixed order, it is useful to pick a fixed number of elements from Figure~\ref{timing} . . .

\section{Conclusion}

\bibliography{tree}

\end{document}
