\documentclass[12pt]{article}

% input
\bibliographystyle{ieeetr}
\usepackage[utf8]{inputenc}
%\usepackage{times} % font
\usepackage{lmodern} % scalable font
\usepackage[pdftex]{graphicx} % include graphics
\usepackage{amsmath} % align, nobreakdash
\usepackage[pdf,tmpdir]{graphviz} % digraph
\usepackage{fullpage} % book margins -> std margins
\usepackage{wrapfig} % wrapfigure
%\usepackage{moreverb} % verbatimtabinput
\usepackage{subcaption} % subcaptionbox
\usepackage[colorlinks]{hyperref} % pdf links
\usepackage{url} % url support
%\usepackage{comment} % comment
\usepackage{xfrac}
\usepackage[table]{xcolor}

\usepackage{siunitx}
%\usepackage{graphicx} already
\usepackage{latexsym}
\usepackage{keyval}
\usepackage{ifthen}
\usepackage{moreverb}
\usepackage[siunitx, subfolder]{gnuplottex}

% https://tex.stackexchange.com/questions/259247/rescaling-gnuplottex-to-fit-in-subfigure
%\usepackage{epstopdf}
%\usepackage{printlen}
%\usepackage[utf8]{inputenx}
%\usepackage{xparse}
%\ExplSyntaxOn
%\DeclareExpandableDocumentCommand{\convertlen}{ O{cm} m }
% {
%  \dim_to_unit:nn { #2 } { 1 #1 } cm
% }
%\ExplSyntaxOff
% fuck it, just guess

\newcommand{\code}[1]{\colorbox{light-gray}{\texttt{#1}}}
\def\Scale{0.5}

% colourize titles
\definecolor{light-gray}{gray}{0.95}
\definecolor{ilrblue}{RGB}{79,166,220}
\usepackage{titling}
\pretitle{\vspace{-3em}\fontfamily{\sfdefault}\fontsize{18bp}{18bp}\color{ilrblue}\selectfont}
\posttitle{\par\vspace{18bp}}
\preauthor{\normalfont\bfseries\selectfont\MakeUppercase}
\postauthor{\par\vspace{4bp}}
\predate{\normalfont\selectfont}
\postdate{\par\vspace{-8bp}}
\usepackage{titlesec}
\titleformat{\section}{\fontfamily{\sfdefault}\selectfont\normalsize\bfseries\color{ilrblue}\MakeUppercase}{\thesection}{1em}{}
\titleformat{\subsection}{\fontfamily{\sfdefault}\normalsize\bfseries\color{ilrblue}}{\thesubsection}{1em}{}
\titleformat{\subsubsection}{\fontfamily{\sfdefault}\normalsize\bfseries\color{ilrblue}\it}{\thesubsubsection}{1em}{}
\makeatletter
\renewenvironment{abstract}{%
    \if@twocolumn
      \section*{\abstractname}%
    \else \small %
      \begin{center}%
        {\bfseries\color{ilrblue} \abstractname\vspace{\z@}\vspace{-6bp}}%
      \end{center}%
      \quotation
    \fi}
    {\if@twocolumn\else\endquotation\fi}
\makeatother

% for hyperref
\hypersetup{
  linkcolor=ilrblue, % internal (figure) links
  urlcolor=ilrblue,
  filecolor=ilrblue,
  citecolor=ilrblue, % bibliography links
  pdfauthor={Neil},
  pdftitle={Tree},
  pdfsubject={Tree},
  pdfpagemode=UseNone
}

\author{Neil A. Edelman}
\title{B-tree design}
\date{2022-08-05}

\begin{document}

\maketitle

\abstract{Several design decisions for a practical B-tree are discussed.}

\section{Design}

A tree is used as an ordered set or map. For memory locality, this is implemented B-tree\cite{bayer1972organization}. In an implementation for C, we would expect memory usage to be low, performance to be high, and simplicity over complexity. Practically, this means that B$^+$-trees and B$^*$-trees are less attractive, along with an added layer of order statistic tree. The nodes are linked one-way and iteration is very simple. This precludes multi-maps. The use-case has no concurrency and places importance on modification.

\subsection{Branching factor}

The branching factor, or order as \cite{knuth1998sorting}, is a fixed value between $[3,\text{UCHAR\_MAX}+1]$. The implementation has no buffering or middle-memory management. Thus, a high-order means greater memory allocation granularity, leading to asymptotically desirable trees. Small values produce much more compact trees. Four produces an isomorphism with left-leaning red-black trees\cite{sedgewick2008left}. In general, it is left-leaning where convenient because keys on the right side are faster to move because of the array configuration of the nodes.

\subsection{Minimum and maximum keys}

We use fixed-length nodes. In \cite{goodrich2011data}, these are $(a,b)$-trees as $(\text{minimum}+1, \text{maxumum}+1)$\nobreakdash-trees. That is, the maximum is the node's key capacity. Since the keys can be thought of as an implicit complete binary tree, necessarily maximum+1 is the order. Unlike \cite{knuth1998sorting}, we differentiate by branch and leaf; a leaf node has no need for null-children, so we don't include them.

Performance will be
$\mathcal{O}(\log_{\text{minimum}+1} \text{size})$. Equation~\ref{usual-min} gives the standard B-tree minimum in terms of the maximum.

\begin{align}
\text{minimum} = \left\lceil \frac{\text{maximum}+1}{2} \right\rceil - 1 \label{usual-min}
\end{align}

Freeing at empty gives good results in \cite{johnson1993b}. We compromise with Equation~\ref{min}. Designed to be less-eager and provides some hysteresis while balancing asymptotic performance.

\begin{align}
\text{minimum} = \left\lceil \frac{\text{maximum}+1}{3} \right\rceil - 1 \label{min}
\end{align}

In a sense, it is the opposite of a B$^*$-tree\cite{knuth1998sorting, douglas1979ubiquitous}, where $\frac{1}{3}$ instead of $\frac{2}{3}$ of the capacity is full: instead of being stricter, it is lazier.

\subsection{Bulk loading}

Bulk loading is ordered addition such that the key is always the maximum in the tree so far. Initially, this will produce a more compact tree. For example, Figure~\ref{bulk} shows bulk addition of natural numbers in order. Compare adding them normally: after a split, there's not any more keys on the low side, asymptotically resulting in one-half occupancy.

Bulk-add will add the key to the maximum side at the lowest level where there is space, ignoring the rules for splitting. If this is a non-leaf, additional nodes with no-keys and one child are recruited. If there is no space at all on the maximum side, another level is made. Because the B-tree rules may be violated, it is important to finalize the tree where bulk-addition has occurred; this balances and restores the B-tree invariants on the right side of the tree under the root.

\begin{figure}%
	\centering%
	\subcaptionbox{Bulk add 1, 2.\label{bulk:2}}{%
		\digraph[scale=\Scale]{bulk2}{
	graph [truecolor=true, bgcolor=transparent, fontname="Bitstream Vera Sans", splines=false];
	node [shape=none, fontname="Bitstream Vera Sans"];
	trunk0x1005326f0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Argda</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">1</td>
	<td border="0" align="center" port="1">2</td>
	</tr>
</table>>];
		}
	}
	\subcaptionbox{Bulk add 3.\label{bulk:3}}{%
		\digraph[scale=\Scale]{bulk3}{
	graph [truecolor=true, bgcolor=transparent, fontname="Bitstream Vera Sans", splines=false];
	node [shape=none, fontname="Bitstream Vera Sans"];
	trunk0x10200c010 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Snamog</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">3</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x10200c010:0:sw -> trunk0x1005326f0;
	trunk0x10200c010:0:se -> trunk0x10200b1e0;
	trunk0x1005326f0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Argda</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">1</td>
	<td border="0" align="center" port="1">2</td>
	</tr>
</table>>];
	trunk0x10200b1e0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Mausnar</font></td></tr>
	<hr/>
	<tr>
	<td border="0" port="0">&nbsp;</td>
	</tr>
</table>>];
		}
	}\\
	\subcaptionbox{Finalize after 3.\label{bulk:3finish}}{%
		\digraph[scale=\Scale]{bulk3finish}{
	graph [truecolor=true, bgcolor=transparent, fontname="Bitstream Vera Sans", splines=false];
	node [shape=none, fontname="Bitstream Vera Sans"];
	trunk0x10200c010 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Snamog</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">2</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x10200c010:0:sw -> trunk0x1005326f0;
	trunk0x10200c010:0:se -> trunk0x10200b1e0;
	trunk0x1005326f0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Argda</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">1</td>
	</tr>
</table>>];
	trunk0x10200b1e0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Mausnar</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">3</td>
	</tr>
</table>>];
		}
	}
	\subcaptionbox{Or bulk add 4.\label{bulk:4}}{%
		\digraph[scale=\Scale]{bulk4}{
	graph [truecolor=true, bgcolor=transparent, fontname="Bitstream Vera Sans", splines=false];
	node [shape=none, fontname="Bitstream Vera Sans"];
	trunk0x10200c010 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Snamog</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">3</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x10200c010:0:sw -> trunk0x1005326f0;
	trunk0x10200c010:0:se -> trunk0x10200b1e0;
	trunk0x1005326f0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Argda</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">1</td>
	<td border="0" align="center" port="1">2</td>
	</tr>
</table>>];
	trunk0x10200b1e0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Mausnar</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">4</td>
	</tr>
</table>>];
		}
	}
    \caption{Order-3, maximum keys 2, bulk-addition, with labels for nodes.
\ref{bulk:2}. keys 1, 2: full tree.
\ref{bulk:3}. adding 3 increases the height. Minimum invariant is violated for \code{Mausnar}.
\ref{bulk:3finish}. finalize would balance all the right nodes below the root.
\ref{bulk:4}. or continue adding 4 to \ref{bulk:3}.}%
	\label{bulk}%
\end{figure}%

\subsection{Adding a key}

\begin{figure}
	\centering%
	\digraph[scale=\Scale]{add}{
	graph [truecolor=true, bgcolor=transparent, fontname="Bitstream Vera Sans"];
	node [shape=record, style=filled, fontname="Bitstream Vera Sans", fillcolor="Grey90"];
	edge [fontname="Bitstream Vera Sans"];
	add [shape=circle, style=none];
	error [label="ERROR", shape=none, style=none];
	error2 [label="ERROR", shape=none, style=none];
	unique [label="UNIQUE", shape=none, style=none];
	yield [label="YIELD", shape=none, style=none];
	idle -> error;
	add -> idle [label="root dne"];
	add -> empty [label="root empty"];
	add -> descend;
	idle -> empty;
	empty -> insert;
	descend -> yield [label="equal"];
	descend -> insert [label="hole=add"];
	descend -> grow;
	grow -> split;
	grow -> error2;
	split -> split;
	split -> fill -> unique;
	insert -> unique;
	}
    \caption{The requirements for \code{add} are $\mathcal{O}(1)$ space and $\mathcal{O}(\log \text{size})$ time, with no parent pointers. State diagram of adding a key, traversing a maximum twice.}%
	\label{add}%
\end{figure}%

Adding a key is shown schematically in Figure~\ref{add}. \code{idle} is no dynamic memory; \code{empty} contains an unused node. \code{ERROR} from \code{idle} and \code{grow} is a memory error; the state of the tree remains unchanged.

The \code{descend} path is taken by any non-empty tree, and descends the tree to find the space in the leaf that it will go. It stops with \code{YIELD} if it finds an already present match. When it completes finding a new key in a leaf node, the \code{hole} will be the lowest-height node that has free space in the path from the root to that leaf.

A non-empty leaf node results in the \code{insert} path, and a single time down the tree; specifying a high-order makes taking this path more likely than having to repeat, but makes the reservation of keys more aggressive.

\begin{figure}
	\centering%
	\subcaptionbox{Full tree of even numbers.\label{even:full}}{%
		\digraph[scale=0.45]{add0}{
	graph [truecolor=true, bgcolor=transparent, fontname="Bitstream Vera Sans", splines=false];
	node [shape=none, fontname="Bitstream Vera Sans"];
	trunk0x100604080 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Iabug</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">18</td>
	<td border="0" align="center" port="1">36</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x100604080:0:sw -> trunk0x100604480;
	trunk0x100604080:0:se -> trunk0x10281b590;
	trunk0x100604080:1:se -> trunk0x1006040f0;
	trunk0x100604480 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Dabshar</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">6</td>
	<td border="0" align="center" port="1">12</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x100604480:0:sw -> trunk0x100537ef0;
	trunk0x100604480:0:se -> trunk0x1006040e0;
	trunk0x100604480:1:se -> trunk0x100604520;
	trunk0x100537ef0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Fidan</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">2</td>
	<td border="0" align="center" port="1">4</td>
	</tr>
</table>>];
	trunk0x1006040e0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Rutdan</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">8</td>
	<td border="0" align="center" port="1">10</td>
	</tr>
</table>>];
	trunk0x100604520 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Umologath</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">14</td>
	<td border="0" align="center" port="1">16</td>
	</tr>
</table>>];
	trunk0x10281b590 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Radien</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">24</td>
	<td border="0" align="center" port="1">30</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x10281b590:0:sw -> trunk0x10281b5c0;
	trunk0x10281b590:0:se -> trunk0x100531520;
	trunk0x10281b590:1:se -> trunk0x100537dd0;
	trunk0x10281b5c0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Ickpuga</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">20</td>
	<td border="0" align="center" port="1">22</td>
	</tr>
</table>>];
	trunk0x100531520 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Nashsinat</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">26</td>
	<td border="0" align="center" port="1">28</td>
	</tr>
</table>>];
	trunk0x100537dd0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Etholog</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">32</td>
	<td border="0" align="center" port="1">34</td>
	</tr>
</table>>];
	trunk0x1006040f0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Ufthluk</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">42</td>
	<td border="0" align="center" port="1">48</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x1006040f0:0:sw -> trunk0x100537120;
	trunk0x1006040f0:0:se -> trunk0x1005329b0;
	trunk0x1006040f0:1:se -> trunk0x100535b20;
	trunk0x100537120 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Azansha</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">38</td>
	<td border="0" align="center" port="1">40</td>
	</tr>
</table>>];
	trunk0x1005329b0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Fimak</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">44</td>
	<td border="0" align="center" port="1">46</td>
	</tr>
</table>>];
	trunk0x100535b20 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Shaak</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">50</td>
	<td border="0" align="center" port="1">52</td>
	</tr>
</table>>];
		}
	}\\
	\subcaptionbox{Add 9; four new nodes, the first split.\label{even:work1}}{%
		\digraph[width=0.4\textwidth]{evenwork1}{
	graph [truecolor=true, bgcolor=transparent, fontname="Bitstream Vera Sans", splines=false];
	node [shape=none, fontname="Bitstream Vera Sans"];
	trunk0x10075f990 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Urbolgun</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">hole</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x10075f990:0:sw -> trunk0x100604080;
	trunk0x10075f990:0:se -> trunk0x10075f9c0;
	trunk0x100604080 [label = <
<table border="0" cellspacing="0" bgcolor="Grey95">
	<tr><td border="0" colspan="2"><font color="Grey50">Iabug</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">18</td>
	<td border="0" align="center" port="1">36</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x100604080:0:sw -> trunk0x100604480;
	trunk0x100604080:0:se -> trunk0x10281b590;
	trunk0x100604080:1:se -> trunk0x1006040f0;
	trunk0x100604480 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Dabshar</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">6</td>
	<td border="0" align="center" port="1">12</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x100604480:0:sw -> trunk0x100537ef0;
	trunk0x100604480:0:se -> trunk0x1006040e0;
	trunk0x100604480:1:se -> trunk0x100604520;
	trunk0x100537ef0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Fidan</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">2</td>
	<td border="0" align="center" port="1">4</td>
	</tr>
</table>>];
	trunk0x1006040e0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Rutdan</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">8</td>
	<td border="0" align="center" port="1">10</td>
	</tr>
</table>>];
	trunk0x100604520 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Umologath</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">14</td>
	<td border="0" align="center" port="1">16</td>
	</tr>
</table>>];
	trunk0x10281b590 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Radien</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">24</td>
	<td border="0" align="center" port="1">30</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x10281b590:0:sw -> trunk0x10281b5c0;
	trunk0x10281b590:0:se -> trunk0x100531520;
	trunk0x10281b590:1:se -> trunk0x100537dd0;
	trunk0x10281b5c0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Ickpuga</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">20</td>
	<td border="0" align="center" port="1">22</td>
	</tr>
</table>>];
	trunk0x100531520 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Nashsinat</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">26</td>
	<td border="0" align="center" port="1">28</td>
	</tr>
</table>>];
	trunk0x100537dd0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Etholog</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">32</td>
	<td border="0" align="center" port="1">34</td>
	</tr>
</table>>];
	trunk0x1006040f0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Ufthluk</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">42</td>
	<td border="0" align="center" port="1">48</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x1006040f0:0:sw -> trunk0x100537120;
	trunk0x1006040f0:0:se -> trunk0x1005329b0;
	trunk0x1006040f0:1:se -> trunk0x100535b20;
	trunk0x100537120 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Azansha</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">38</td>
	<td border="0" align="center" port="1">40</td>
	</tr>
</table>>];
	trunk0x1005329b0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Fimak</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">44</td>
	<td border="0" align="center" port="1">46</td>
	</tr>
</table>>];
	trunk0x100535b20 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Shaak</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">50</td>
	<td border="0" align="center" port="1">52</td>
	</tr>
</table>>];
	trunk0x10075f9c0 [label = <
<table border="0" cellspacing="0" bgcolor="Grey95">
	<tr><td border="0" colspan="1"><font color="Gray50">Beoub</font></td></tr>
	<hr/>
	<tr>
	<td border="0" port="0">&nbsp;</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x10075f9c0:0:sw -> trunk0x10075f9f0;
	trunk0x10075f9f0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Naagh</font></td></tr>
	<hr/>
	<tr>
	<td border="0" port="0">&nbsp;</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x10075f9f0:0:sw -> trunk0x100735af0;
	trunk0x100735af0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Olog</font></td></tr>
	<hr/>
	<tr>
	<td border="0" port="0">&nbsp;</td>
	</tr>
</table>>];
	node [color="Red"];
		}
	}
	\subcaptionbox{After one split.\label{even:work2}}{%
		\digraph[width=0.4\textwidth]{evenwork2}{
	graph [truecolor=true, bgcolor=transparent, fontname="Bitstream Vera Sans", splines=false];
	node [shape=none, fontname="Bitstream Vera Sans"];
	trunk0x10075f990 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Urbolgun</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">18</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x10075f990:0:sw -> trunk0x100604080;
	trunk0x10075f990:0:se -> trunk0x10075f9c0;
	trunk0x100604080 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Iabug</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">hole</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x100604080:0:sw -> trunk0x100604480;
	trunk0x100604080:0:se -> trunk0x10075f9f0;
	trunk0x100604480 [label = <
<table border="0" cellspacing="0" bgcolor="Grey95">
	<tr><td border="0" colspan="2"><font color="Gray50">Dabshar</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">6</td>
	<td border="0" align="center" port="1">12</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x100604480:0:sw -> trunk0x100537ef0;
	trunk0x100604480:0:se -> trunk0x1006040e0;
	trunk0x100604480:1:se -> trunk0x100604520;
	trunk0x100537ef0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Fidan</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">2</td>
	<td border="0" align="center" port="1">4</td>
	</tr>
</table>>];
	trunk0x1006040e0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Rutdan</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">8</td>
	<td border="0" align="center" port="1">10</td>
	</tr>
</table>>];
	trunk0x100604520 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Umologath</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">14</td>
	<td border="0" align="center" port="1">16</td>
	</tr>
</table>>];
	trunk0x10075f9f0 [label = <
<table border="0" cellspacing="0" bgcolor="Grey95">
	<tr><td border="0" colspan="1"><font color="Gray50">Naagh</font></td></tr>
	<hr/>
	<tr>
	<td border="0" port="0">&nbsp;</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x10075f9f0:0:sw -> trunk0x100735af0;
	trunk0x100735af0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Olog</font></td></tr>
	<hr/>
	<tr>
	<td border="0" port="0">&nbsp;</td>
	</tr>
</table>>];
	trunk0x10075f9c0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Beoub</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">36</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x10075f9c0:0:sw -> trunk0x10281b590;
	trunk0x10075f9c0:0:se -> trunk0x1006040f0;
	trunk0x10281b590 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Radien</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">24</td>
	<td border="0" align="center" port="1">30</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x10281b590:0:sw -> trunk0x10281b5c0;
	trunk0x10281b590:0:se -> trunk0x100531520;
	trunk0x10281b590:1:se -> trunk0x100537dd0;
	trunk0x10281b5c0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Ickpuga</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">20</td>
	<td border="0" align="center" port="1">22</td>
	</tr>
</table>>];
	trunk0x100531520 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Nashsinat</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">26</td>
	<td border="0" align="center" port="1">28</td>
	</tr>
</table>>];
	trunk0x100537dd0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Etholog</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">32</td>
	<td border="0" align="center" port="1">34</td>
	</tr>
</table>>];
	trunk0x1006040f0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Ufthluk</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">42</td>
	<td border="0" align="center" port="1">48</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x1006040f0:0:sw -> trunk0x100537120;
	trunk0x1006040f0:0:se -> trunk0x1005329b0;
	trunk0x1006040f0:1:se -> trunk0x100535b20;
	trunk0x100537120 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Azansha</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">38</td>
	<td border="0" align="center" port="1">40</td>
	</tr>
</table>>];
	trunk0x1005329b0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Fimak</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">44</td>
	<td border="0" align="center" port="1">46</td>
	</tr>
</table>>];
	trunk0x100535b20 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Shaak</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">50</td>
	<td border="0" align="center" port="1">52</td>
	</tr>
</table>>];
		}
	}
	\subcaptionbox{Further split.\label{even:work3}}{%
		\digraph[width=0.4\textwidth]{evenwork3}{
	graph [truecolor=true, bgcolor=transparent, fontname="Bitstream Vera Sans", splines=false];
	node [shape=none, fontname="Bitstream Vera Sans"];
	trunk0x10075f990 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Urbolgun</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">18</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x10075f990:0:sw -> trunk0x100604080;
	trunk0x10075f990:0:se -> trunk0x10075f9c0;
	trunk0x100604080 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Iabug</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">hole</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x100604080:0:sw -> trunk0x100604480;
	trunk0x100604080:0:se -> trunk0x10075f9f0;
	trunk0x100604480 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Dabshar</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">6</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x100604480:0:sw -> trunk0x100537ef0;
	trunk0x100604480:0:se -> trunk0x1006040e0;
	trunk0x100537ef0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Fidan</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">2</td>
	<td border="0" align="center" port="1">4</td>
	</tr>
</table>>];
	trunk0x1006040e0 [label = <
<table border="0" cellspacing="0" bgcolor="Grey90">
	<tr><td border="0" colspan="2"><font color="Gray50">Rutdan</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">8</td>
	<td border="0" align="center" port="1">10</td>
	</tr>
</table>>];
	trunk0x10075f9f0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Naagh</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">12</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x10075f9f0:0:sw -> trunk0x100735af0;
	trunk0x10075f9f0:0:se -> trunk0x100604520;
	trunk0x100735af0 [label = <
<table border="0" cellspacing="0" bgcolor="Grey90">
	<tr><td border="0" colspan="1"><font color="Gray50">Olog</font></td></tr>
	<hr/>
	<tr>
	<td border="0" port="0">&nbsp;</td>
	</tr>
</table>>];
	trunk0x100604520 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Umologath</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">14</td>
	<td border="0" align="center" port="1">16</td>
	</tr>
</table>>];
	trunk0x10075f9c0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Beoub</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">36</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x10075f9c0:0:sw -> trunk0x10281b590;
	trunk0x10075f9c0:0:se -> trunk0x1006040f0;
	trunk0x10281b590 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Radien</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">24</td>
	<td border="0" align="center" port="1">30</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x10281b590:0:sw -> trunk0x10281b5c0;
	trunk0x10281b590:0:se -> trunk0x100531520;
	trunk0x10281b590:1:se -> trunk0x100537dd0;
	trunk0x10281b5c0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Ickpuga</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">20</td>
	<td border="0" align="center" port="1">22</td>
	</tr>
</table>>];
	trunk0x100531520 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Nashsinat</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">26</td>
	<td border="0" align="center" port="1">28</td>
	</tr>
</table>>];
	trunk0x100537dd0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Etholog</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">32</td>
	<td border="0" align="center" port="1">34</td>
	</tr>
</table>>];
	trunk0x1006040f0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Ufthluk</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">42</td>
	<td border="0" align="center" port="1">48</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x1006040f0:0:sw -> trunk0x100537120;
	trunk0x1006040f0:0:se -> trunk0x1005329b0;
	trunk0x1006040f0:1:se -> trunk0x100535b20;
	trunk0x100537120 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Azansha</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">38</td>
	<td border="0" align="center" port="1">40</td>
	</tr>
</table>>];
	trunk0x1005329b0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Fimak</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">44</td>
	<td border="0" align="center" port="1">46</td>
	</tr>
</table>>];
	trunk0x100535b20 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Shaak</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">50</td>
	<td border="0" align="center" port="1">52</td>
	</tr>
</table>>];
		}
	}
	\subcaptionbox{After fill.\label{even:insert}}{%
		\digraph[scale=0.45]{add1}{
	graph [truecolor=true, bgcolor=transparent, fontname="Bitstream Vera Sans", splines=false];
	node [shape=none, fontname="Bitstream Vera Sans"];
	trunk0x10075f990 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Urbolgun</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">18</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x10075f990:0:sw -> trunk0x100604080;
	trunk0x10075f990:0:se -> trunk0x10075f9c0;
	trunk0x100604080 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Iabug</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">9</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x100604080:0:sw -> trunk0x100604480;
	trunk0x100604080:0:se -> trunk0x10075f9f0;
	trunk0x100604480 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Dabshar</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">6</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x100604480:0:sw -> trunk0x100537ef0;
	trunk0x100604480:0:se -> trunk0x1006040e0;
	trunk0x100537ef0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Fidan</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">2</td>
	<td border="0" align="center" port="1">4</td>
	</tr>
</table>>];
	trunk0x1006040e0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Rutdan</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">8</td>
	</tr>
</table>>];
	trunk0x10075f9f0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Naagh</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">12</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x10075f9f0:0:sw -> trunk0x100735af0;
	trunk0x10075f9f0:0:se -> trunk0x100604520;
	trunk0x100735af0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Olog</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">10</td>
	</tr>
</table>>];
	trunk0x100604520 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Umologath</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">14</td>
	<td border="0" align="center" port="1">16</td>
	</tr>
</table>>];
	trunk0x10075f9c0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="1"><font color="Gray75">Beoub</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">36</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x10075f9c0:0:sw -> trunk0x10281b590;
	trunk0x10075f9c0:0:se -> trunk0x1006040f0;
	trunk0x10281b590 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Radien</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">24</td>
	<td border="0" align="center" port="1">30</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x10281b590:0:sw -> trunk0x10281b5c0;
	trunk0x10281b590:0:se -> trunk0x100531520;
	trunk0x10281b590:1:se -> trunk0x100537dd0;
	trunk0x10281b5c0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Ickpuga</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">20</td>
	<td border="0" align="center" port="1">22</td>
	</tr>
</table>>];
	trunk0x100531520 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Nashsinat</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">26</td>
	<td border="0" align="center" port="1">28</td>
	</tr>
</table>>];
	trunk0x100537dd0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Etholog</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">32</td>
	<td border="0" align="center" port="1">34</td>
	</tr>
</table>>];
	trunk0x1006040f0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Ufthluk</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">42</td>
	<td border="0" align="center" port="1">48</td>
	</tr>
	<hr/>
	<tr><td></td></tr>
</table>>];
	trunk0x1006040f0:0:sw -> trunk0x100537120;
	trunk0x1006040f0:0:se -> trunk0x1005329b0;
	trunk0x1006040f0:1:se -> trunk0x100535b20;
	trunk0x100537120 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Azansha</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">38</td>
	<td border="0" align="center" port="1">40</td>
	</tr>
</table>>];
	trunk0x1005329b0 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Fimak</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">44</td>
	<td border="0" align="center" port="1">46</td>
	</tr>
</table>>];
	trunk0x100535b20 [label = <
<table border="0" cellspacing="0">
	<tr><td border="0" colspan="2"><font color="Gray75">Shaak</font></td></tr>
	<hr/>
	<tr>
	<td border="0" align="center" port="0">50</td>
	<td border="0" align="center" port="1">52</td>
	</tr>
</table>>];
		}
	}
    \caption{\ref{even:full}: order-3 full tree. \ref{even:work1} -- \ref{even:work3}: working down the tree. \ref{even:insert}: addition of any number will cause the tree height to increase.}%
	\label{even}%
\end{figure}%

An add must \code{grow} if it has the maximum keys in the leaf node. The height of the \code{hole} (zero-based) is the number of nodes extra that need to be reserved. A null \code{hole} means all of the path is full of keys; this requires increased tree height: tree height + 2 nodes. These new nodes are strung together and added to the tree.

\code{split} introduces \code{cursor}, along the path to the leaf, and \code{sibling}, the new zero-key node.  in the path to the key and expands it to include \code{hole}, thus splits it with the popped item from the stack. \code{hole} can either go to the left, right, or exactly in between. Now \code{cursor} does not have a full node, so it descends height on the path. This repeats while the stack is not empty. In \text{fill}, the added key then goes in \code{hole}.

In Figure~\ref{even}, the path from \ref{even:full} to \ref{even:insert} to insert 9 on Figure~\ref{add} is \code{descend}, \code{grow}, \code{split} four times (the maximum for this size), \code{fill}, and returns \code{UNIQUE}. The new nodes are (branches) \code{Urbolgun}, \code{Beoub}, \code{Naagh}, and (leaf) \code{Olog}. This is the most complicated path, when the height increases.

\subsection{Deleting a key}



\section{Conclusion}

\bibliography{tree}

\end{document}
