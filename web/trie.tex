\documentclass[12pt]{article}

\usepackage[utf8]{inputenc}
\usepackage[pdf,tmpdir]{graphviz} % \detokenize to use utf-8 [singlefile]

% code doesn't wrap
\usepackage{xcolor}
\definecolor{light-gray}{gray}{0.95}
\newcommand{\code}[1]{\colorbox{light-gray}{\texttt{#1}}}

\usepackage{times}      % font
\usepackage{graphicx}   % include graphics
\usepackage{fullpage}   % book margins -> std margins
\usepackage{amsmath}    % {align}
%\usepackage{wrapfig}    % {wrapfigure}
%\usepackage{moreverb}   % \verbatimtabinput
%\usepackage{subfig}     % sub-figure
\usepackage{subcaption}
\usepackage[colorlinks]{hyperref}   % pdf links
\usepackage{url}        % url support
\usepackage{comment}

% ieee style
\bibliographystyle{ieeetr}

% define "\fig"
\def\fig#1#2{\begin{figure}[!ht]\begin{center}
\includegraphics[width=0.5\textwidth]{#1.jpg}
\end{center}\caption{#2}\label{#1}\end{figure}}

\def\wide#1#2{\begin{figure*}[hptb]\begin{center}
\includegraphics[height=0.5\textwidth]{#1.jpg}
\end{center}\vspace{-0pt}\caption{#2}\label{#1}\end{figure*}}

% create new commands
\def\^#1{\textsuperscript{#1}}
\def\!{\overline}
\def\degree{\ensuremath{^\circ}}

% for hyperref
\hypersetup{
  linkcolor=blue,
  urlcolor=blue,
  filecolor=blue,
  citecolor=blue, % that's it
  pdfauthor={\@author},
  pdftitle={\@title},
  pdfsubject={\@title},
  pdfpagemode=UseNone
}

% info
\author{Neil Edelman}
\title{Prefix-B-trees as an Index}
\date{2021}

\begin{document}

\maketitle

\abstract{This is the abstract.}

\section{Introduction}

\noindent
Intro.\cite{morrison1968patricia}\cite{fredkin1960trie}\cite{knuth1997sorting}

\subsection{Abstract Data Type}

This is a set on a variable-length key, always terminated by a sentinel (allow a string is a prefix of another string in the same trie). It is ordered, and permits range queries with a prefix.

For proper ordering, most-significant bit first; prefix strings the sentinel should be less-than the encoding of all the characters. In practice, a null-terminated string. A Modified~UTF-8 example is Figure~\ref{star-3:bits}. It stores the keys in lexicographic order, but not by any collation algorithm.

terminator, like in that paper; a terminator will . This terminator should have less-than all the other characters for ordering, so by a \emph{string} we mean \emph{a null-terminated string}. ; for example, in Modified UTF-8, \code{Z < a < z < æ}. show a picture


% star-3
\begin{figure} %[!ht]
	\centering
	\subcaptionbox{Bit view.\label{star-3:bits}}{%
		\digraph[scale=0.6]{star3bits}{
	node [shape = none];
	tree0x1028049c0branch0 [shape = box, style = filled, fillcolor="Grey95" label = <
<TABLE BORDER="0" CELLBORDER="0">
	<TR>
		<TD ALIGN="LEFT" BORDER="0" PORT="0">Algieba</TD>
		<TD>0</TD>
		<TD>1</TD>
		<TD>0</TD>
		<TD BGCOLOR="White" BORDER="1">0</TD>
	</TR>
	<TR>
		<TD ALIGN="LEFT" BORDER="0" PORT="1">Regulus</TD>
		<TD>0</TD>
		<TD>1</TD>
		<TD>0</TD>
		<TD BGCOLOR="Black" COLOR="White" BORDER="1"><FONT COLOR="White">1</FONT></TD>
		<TD>0</TD>
		<TD BGCOLOR="White" BORDER="1">0</TD>
	</TR>
	<TR>
		<TD ALIGN="LEFT" BORDER="0" PORT="2">Vega</TD>
		<TD>0</TD>
		<TD>1</TD>
		<TD>0</TD>
		<TD BGCOLOR="Black" COLOR="White" BORDER="1"><FONT COLOR="White">1</FONT></TD>
		<TD>0</TD>
		<TD BGCOLOR="Black" COLOR="White" BORDER="1"><FONT COLOR="White">1</FONT></TD>
	</TR>
</TABLE>>];
		}
	}
	\subcaptionbox{Logical view.\label{star-3:logic}}{
\digraph[scale=0.6]{star3logic}{
	node [shape = none];
	tree0x1028049c0branch0 [label = "3", shape = circle, style = filled, fillcolor = Grey95];
	tree0x1028049c0branch0 -> tree0x1028049c0leaf0 [style = dashed, color = Gray];
	tree0x1028049c0branch0 -> tree0x1028049c0branch1;
	tree0x1028049c0branch1 [label = "1", shape = circle, style = filled, fillcolor = Grey95];
	tree0x1028049c0branch1 -> tree0x1028049c0leaf1 [style = dashed, color = Gray];
	tree0x1028049c0branch1 -> tree0x1028049c0leaf2 [color = Gray];
	tree0x1028049c0leaf0 [label = "Algieba"];
	tree0x1028049c0leaf1 [label = "Regulus"];
	tree0x1028049c0leaf2 [label = "Vega"];
}}
	\subcaptionbox{Memory view.\label{star-3:mem}}{
\digraph[scale=0.6]{star3mem}{
	node [shape = none];
	tree0x1028049c0branch0 [shape = box, style = filled, fillcolor = Gray95, label = <
<TABLE BORDER="0">
	<TR>
		<TD ALIGN="right" BORDER="0">left</TD>
		<TD BGCOLOR="Gray90">0</TD>
		<TD BGCOLOR="Gray90">0</TD>
	</TR>
	<TR>
		<TD ALIGN="right" BORDER="0">skip</TD>
		<TD>3</TD>
		<TD>1</TD>
	</TR>
	<TR>
		<TD ALIGN="right" BORDER="0">leaves</TD>
		<TD BGCOLOR="Grey90">Algieba</TD>
		<TD BGCOLOR="Grey90">Regulus</TD>
		<TD BGCOLOR="Grey90">Vega</TD>
	</TR>
</TABLE>>];
}}
	\caption{A full 3-trie.\label{star-3}}
\end{figure}

% star-4
\begin{figure}
	\centering
	\subcaptionbox{Bit view.\label{star-4:bits}}{
\digraph[scale=0.6]{star4bits}{
	node [shape = none];
	tree0x1028049f0branch0 [shape = box, style = filled, fillcolor="Grey95" label = <
<TABLE BORDER="0" CELLBORDER="0">
	<TR>
		<TD ALIGN="LEFT" BORDER="0" PORT="0">\detokenize{↓}<FONT COLOR="Gray">Algieba</FONT></TD>
		<TD>0</TD>
		<TD>1</TD>
		<TD>0</TD>
		<TD BGCOLOR="White" BORDER="1">0</TD>
	</TR>
	<TR>
		<TD ALIGN="LEFT" BORDER="0" PORT="1">\detokenize{↓}<FONT COLOR="Gray">Regulus</FONT></TD>
		<TD>0</TD>
		<TD>1</TD>
		<TD>0</TD>
		<TD BGCOLOR="Black" COLOR="White" BORDER="1"><FONT COLOR="White">1</FONT></TD>
	</TR>
</TABLE>>];
	tree0x1028049f0branch0:0 -> tree0x1028049c0branch0 [color = "Black:invis:Black" style = dashed];
	tree0x1028049f0branch0:1 -> tree0x102804a20branch0 [color = "Black:invis:Black"];
	tree0x1028049c0branch0 [shape = box, style = filled, fillcolor="Grey95" label = <
<TABLE BORDER="0" CELLBORDER="0">
	<TR>
		<TD ALIGN="LEFT" BORDER="0" PORT="0">Algieba</TD>
		<TD>0</TD>
		<TD>1</TD>
		<TD>0</TD>
		<TD>0</TD>
		<TD>0</TD>
		<TD>0</TD>
		<TD>0</TD>
		<TD>1</TD>
		<TD BORDER="0">&nbsp;</TD>
		<TD>0</TD>
		<TD>1</TD>
		<TD>1</TD>
		<TD>0</TD>
		<TD>1</TD>
		<TD>1</TD>
		<TD>0</TD>
		<TD>0</TD>
		<TD BORDER="0">&nbsp;</TD>
		<TD>0</TD>
		<TD>1</TD>
		<TD>1</TD>
		<TD BGCOLOR="White" BORDER="1">0</TD>
	</TR>
	<TR>
		<TD ALIGN="LEFT" BORDER="0" PORT="1">Alpheratz</TD>
		<TD>0</TD>
		<TD>1</TD>
		<TD>0</TD>
		<TD>0</TD>
		<TD>0</TD>
		<TD>0</TD>
		<TD>0</TD>
		<TD>1</TD>
		<TD BORDER="0">&nbsp;</TD>
		<TD>0</TD>
		<TD>1</TD>
		<TD>1</TD>
		<TD>0</TD>
		<TD>1</TD>
		<TD>1</TD>
		<TD>0</TD>
		<TD>0</TD>
		<TD BORDER="0">&nbsp;</TD>
		<TD>0</TD>
		<TD>1</TD>
		<TD>1</TD>
		<TD BGCOLOR="Black" COLOR="White" BORDER="1"><FONT COLOR="White">1</FONT></TD>
	</TR>
</TABLE>>];
	tree0x102804a20branch0 [shape = box, style = filled, fillcolor="Grey95" label = <
<TABLE BORDER="0" CELLBORDER="0">
	<TR>
		<TD ALIGN="LEFT" BORDER="0" PORT="0">Regulus</TD>
		<TD>0</TD>
		<TD>1</TD>
		<TD>0</TD>
		<TD>1</TD>
		<TD>0</TD>
		<TD BGCOLOR="White" BORDER="1">0</TD>
	</TR>
	<TR>
		<TD ALIGN="LEFT" BORDER="0" PORT="1">Vega</TD>
		<TD>0</TD>
		<TD>1</TD>
		<TD>0</TD>
		<TD>1</TD>
		<TD>0</TD>
		<TD BGCOLOR="Black" COLOR="White" BORDER="1"><FONT COLOR="White">1</FONT></TD>
	</TR>
</TABLE>>];
}}
	\subcaptionbox{Logical view.\label{star-4:logic}}{
\digraph[scale=0.6]{star4logic}{
	node [shape = none];
	tree0x1028049f0branch0 [label = "3", shape = circle, style = filled, fillcolor = Grey95];
	tree0x1028049f0branch0 -> tree0x1028049c0branch0 [style = dashed, color = "Black:invis:Black"];
	tree0x1028049f0branch0 -> tree0x102804a20branch0 [color = "Black:invis:Black"];
	tree0x1028049c0branch0 [label = "15", shape = circle, style = filled, fillcolor = Grey95];
	tree0x1028049c0branch0 -> tree0x1028049c0leaf0 [style = dashed, color = Gray];
	tree0x1028049c0branch0 -> tree0x1028049c0leaf1 [color = Gray];
	tree0x1028049c0leaf0 [label = "Algieba"];
	tree0x1028049c0leaf1 [label = "Alpheratz"];
	tree0x102804a20branch0 [label = "1", shape = circle, style = filled, fillcolor = Grey95];
	tree0x102804a20branch0 -> tree0x102804a20leaf0 [style = dashed, color = Gray];
	tree0x102804a20branch0 -> tree0x102804a20leaf1 [color = Gray];
	tree0x102804a20leaf0 [label = "Regulus"];
	tree0x102804a20leaf1 [label = "Vega"];
}}\\
	\subcaptionbox{Memory view.\label{star-4:mem}}{
\digraph[scale=0.6]{star4mem}{
	node [shape = none];
	tree0x1028049f0branch0 [shape = box, style = filled, fillcolor = Gray95, label = <
<TABLE BORDER="0">
	<TR>
		<TD ALIGN="right" BORDER="0">left</TD>
		<TD BGCOLOR="Gray90">0</TD>
	</TR>
	<TR>
		<TD ALIGN="right" BORDER="0">skip</TD>
		<TD>3</TD>
	</TR>
	<TR>
		<TD ALIGN="right" BORDER="0">leaves</TD>
		<TD PORT="0" BGCOLOR="Gray90">...</TD>
		<TD PORT="1" BGCOLOR="Gray90">...</TD>
	</TR>
</TABLE>>];
	tree0x1028049f0branch0:0 -> tree0x1028049c0branch0 [color = "Black:invis:Black" style = dashed];
	tree0x1028049f0branch0:1 -> tree0x102804a20branch0 [color = "Black:invis:Black"];
	tree0x1028049c0branch0 [shape = box, style = filled, fillcolor = Gray95, label = <
<TABLE BORDER="0">
	<TR>
		<TD ALIGN="right" BORDER="0">left</TD>
		<TD BGCOLOR="Gray90">0</TD>
	</TR>
	<TR>
		<TD ALIGN="right" BORDER="0">skip</TD>
		<TD>15</TD>
	</TR>
	<TR>
		<TD ALIGN="right" BORDER="0">leaves</TD>
		<TD BGCOLOR="Grey90">Algieba</TD>
		<TD BGCOLOR="Grey90">Alpheratz</TD>
	</TR>
</TABLE>>];
	tree0x102804a20branch0 [shape = box, style = filled, fillcolor = Gray95, label = <
<TABLE BORDER="0">
	<TR>
		<TD ALIGN="right" BORDER="0">left</TD>
		<TD BGCOLOR="Gray90">0</TD>
	</TR>
	<TR>
		<TD ALIGN="right" BORDER="0">skip</TD>
		<TD>1</TD>
	</TR>
	<TR>
		<TD ALIGN="right" BORDER="0">leaves</TD>
		<TD BGCOLOR="Grey90">Regulus</TD>
		<TD BGCOLOR="Grey90">Vega</TD>
	</TR>
</TABLE>>];
}}
	\caption{Split the 3-trie to put four items.\label{star-4}}
\end{figure}



\subsection{Implementation}

An implementation is an associative-array Patrica trie\cite{morrison1968patricia}: binary, storing only bit differences; Figure~\ref{star-3:logic}.

This is an index: unlike a binary search where the key is retrieved and compared, we have the string decision bit in the key that cuts down the size of the search space. When we get a prefix match, only one string needs to be retrieved to check that it's a match with all the bits that we skipped over.

\subsection{Tree Structure}

non-empty complete binary tree

semi-implicit: lose the ability to go up the tree; have to have the size \ref{star-3:mem}

\subsection{Machine Considerations}

The data has been engineered for maximum effectiveness of the cache in reading and traversing. That is, the tree structure and the string decisions have been reduced to each a byte and placed at the the top of the data structure of the tree. The size of this sub-structure should be a multiple of the cache line size, while also maximizing the dynamic range allowed for each byte; a trie (also a B-tree) of order 256 is an obvious choice.

instead of adding in one big trie, where the data type presents a limit of how big it is, we have pointers to sub-blocks. This is seen in ... This allows us to shrink the data-type significantly; for a non-empty complete binary tree that has `n` leaves (order `n`), it has `n - 1` the internal nodes, or branches. The maximum that the left branch count can be is when the right node of the root is a leaf, that is `n - 2`. If we set this left-branch maximum to the maximum of the data type, we can use all the range. Practically, we set it to 254 instead of 255; the branches take up 255, and the branch size number is 1, for alignment.

\subsection{Limits}

Worst-case $\{ a, aa, aaa, aaaa, ... \}$. The case where the trie has strings that are bounded, as the tree grows, we can guarantee . . .

This is valid, $\{ dictator \}$, as well as, $\{ dictator, dictionary, dictionaries \}$, but one ca'n't transition to $\{ dictionary, dictionaries \}$: it is too long a skip value. There are several modifications that would allow this, but they are out of this scope.

Insertion: Any leaf on the sub-tree queried will do; in this implementation, favours the left side.

on split, do we have to go locally and see if we can join them?

\bibliography{trie}

\end{document}
